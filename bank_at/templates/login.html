<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bank AT Login</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap');

*{
    margin:0;
    padding:0;
    box-sizing:border-box;
    font-family:'Inter',sans-serif;
}

body{
    height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    background-image: linear-gradient(to top, #1e3c72 0%, #1e3c72 1%, #2a5298 100%);
}

.wrapper{
    width:480px;
    height:auto;
    padding:60px 55px;
    border-radius:24px;
    background:rgba(255, 255, 255, 0.06);
    backdrop-filter:blur(20px);
    box-shadow:0 20px 40px rgba(0,0,0,0.45);
    animation:fadeIn .6s ease;
}

@keyframes fadeIn{
    from{opacity:0;transform:translateY(20px);}
    to{opacity:1;transform:translateY(0);}
}

h1{
    text-align:center;
    margin-bottom:35px;
    font-weight:600;
    color:#fff;
}

.input-group{
    position:relative;
    margin-bottom:25px;
}

.input-group input{
    width:100%;
    padding:15px 48px 15px 48px;
    border-radius:14px;
    border:none;
    outline:none;
    font-size:15px;
    background:rgba(255,255,255,0.10);
    color:#fff;
    transition:.25s;
}

.input-group input::placeholder{
    color:rgba(255,255,255,0.6);
}

.input-group input:focus{
    background:rgba(255,255,255,0.18);
    box-shadow:0 0 0 2px #00fff9;
}

.input-group svg{
    stroke: #00fff9;
}

.input-group svg{
    position:absolute;
    top:50%;
    transform:translateY(-50%);
    width:20px;
    height:20px;
    opacity:.8;
}

.icon-left{
    left:14px;
}

.icon-right{
    right:14px;
    cursor:pointer;
}

button{
    width:100%;
    padding:15px;
    border:none;
    border-radius:14px;
    font-size:15px;
    font-weight:600;
    cursor:pointer;
    background:linear-gradient( 90deg, #00fff9, #3c9492);
    color:#083344;
    box-shadow:0 8px 25px rgba(9, 52, 46, 0.35);
    transition:.25s;
}

button:hover{
    transform:translateY(-2px);
    box-shadow:0 12px 30px rgba(45,212,191,0.55);
}

.error-box{
    display:none;
    background:rgba(255,0,0,0.15);
    border:1px solid rgba(255,0,0,0.4);
    color:#ffdddd;
    padding:10px;
    border-radius:8px;
    margin-bottom:15px;
    font-size:14px;
}
</style>
</head>

<body>

<div class="wrapper">
    <h1>Bank AT Kirish</h1>

    <div id="errorBox" class="error-box"></div>

    <form onsubmit="loginUser(event)">
        <div class="input-group">
            <svg class="icon-left" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="8" r="5"/>
                <path d="M20 21a8 8 0 0 0-16 0"/>
            </svg>

            <input type="text" id="username" placeholder="Loginni kiriting" required>
        </div>

        <div class="input-group">
            <svg class="icon-left" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="11" width="18" height="11" rx="2"/>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
            </svg>

            <input type="password" id="password" placeholder="Parolni kiriting" required>
            <svg class="icon-right" onclick="togglePassword()" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"/>
                <circle cx="12" cy="12" r="3"/>
            </svg>
        </div>

        <button type="submit">Kirish</button>

    </form>
</div>

<script>
function parseJwt(token){
    try{
        return JSON.parse(atob(token.split('.')[1]));
    }catch(e){
        return null;
    }
}

function isTokenExpired(token){
    if(!token) return true;
    const payload = parseJwt(token);
    if(!payload || !payload.exp) return true;
    const now = Math.floor(Date.now()/1000);
    return payload.exp < now;
}

const existingToken = localStorage.getItem("access_token");
{% comment %} if(existingToken && !isTokenExpired(existingToken)){
    window.location.href="/home/";
} {% endcomment %}

function togglePassword(){
    const input = document.getElementById("password");
    input.type = input.type === "password" ? "text" : "password";
}

async function loginUser(e){
    e.preventDefault();

    const username = document.getElementById("username").value;
    const password = document.getElementById("password").value;

    try{
        const response = await fetch("/api/v1/token/",{
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({username,password})
        });
        const data = await response.json();
        if(response.ok){
            localStorage.setItem("access_token",data.access);
            localStorage.setItem("refresh_token",data.refresh);
            window.location.href="/home";
        }else{
            showError("Login yoki parol noto‘g‘ri!");
        }

    }catch(err){
        showError("Server bilan bog‘lanib bo‘lmadi");
    }
}

function showError(msg){
    const box=document.getElementById("errorBox");
    box.innerText=msg;
    box.style.display="block";
}

</script>

</body>
</html>